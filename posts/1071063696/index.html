<!doctype html><html lang=zh-cn><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=referrer content="no-referrer"><meta content="飞鸿踏雪" name=author><title>使用 ASP.NET Core 和 Hangfire 实现 HTTP 异步化方案 - 元视角</title>
<meta name=description content="Payne在博客中分享了对XML与JSON在数据交换中的使用背景与困扰，探讨了HTTP异步化方案中的实际场景与解决方法。他介绍了Hangfire作为Quartz的替代品的使用方法和可扩展性，展示了通过HTTP调用的HttpJob的实现方式，以及如何使用Hangfire进行任务调度和记录日志。整体内容围绕着异步化处理、后台任务系统的应用与扩展展开，为读者提供了一些实践参考和技术思路。"><link rel=icon type=image/png href=/images/favicons/favicon-96x96.png sizes=96x96><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><meta name=apple-mobile-web-app-title content="元视角"><link rel=manifest href=/site.webmanifest><meta name=keywords content=".NET Core,Hangfire,HTTP"><meta property="og:title" content="使用 ASP.NET Core 和 Hangfire 实现 HTTP 异步化方案 - 元视角"><meta property="og:description" content="Payne在博客中分享了对XML与JSON在数据交换中的使用背景与困扰，探讨了HTTP异步化方案中的实际场景与解决方法。他介绍了Hangfire作为Quartz的替代品的使用方法和可扩展性，展示了通过HTTP调用的HttpJob的实现方式，以及如何使用Hangfire进行任务调度和记录日志。整体内容围绕着异步化处理、后台任务系统的应用与扩展展开，为读者提供了一些实践参考和技术思路。"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.yuanpei.me/posts/1071063696/"><meta property='og:site_name' content='元视角'><meta property="og:image" content="/images/avatar.jpg"><meta property="twitter:image" content="/images/avatar.jpg"><meta property='article:section' content='Posts'><meta property='article:tag' content='.NET Core'><meta property='article:tag' content='Hangfire'><meta property='article:tag' content='HTTP'><meta property='article:published_time' content='2019-07-04T08:56:28+00:00'><meta property='article:modified_time' content='2019-07-04T08:56:28+00:00'><meta property="twitter:domain" content="https://blog.yuanpei.me/"><meta property="twitter:url" content="https://blog.yuanpei.me/"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog.yuanpei.me/posts/1071063696/"><meta property="twitter:title" content="使用 ASP.NET Core 和 Hangfire 实现 HTTP 异步化方案 - 元视角"><meta property="twitter:description" content="Payne在博客中分享了对XML与JSON在数据交换中的使用背景与困扰，探讨了HTTP异步化方案中的实际场景与解决方法。他介绍了Hangfire作为Quartz的替代品的使用方法和可扩展性，展示了通过HTTP调用的HttpJob的实现方式，以及如何使用Hangfire进行任务调度和记录日志。整体内容围绕着异步化处理、后台任务系统的应用与扩展展开，为读者提供了一些实践参考和技术思路。"><meta name=twitter:site content="飞鸿踏雪"><meta name=twitter:creator content="飞鸿踏雪"><link rel=stylesheet href=/styles/main.min.bb9e9eadbf718b0c91c89c85c701c072a4eaa3846575271b714abf3bc7bb8210.css><link rel=dns-prefetch crossorigin=anonymous href=https://cdn.jsdelivr.net/npm/misans@4.1.0/lib/Normal/MiSans-Medium.min.css><link rel=dns-prefetch crossorigin=anonymous href=https://cdn.jsdelivr.net/npm/misans@4.1.0/lib/Normal/MiSans-Bold.min.css><link rel=stylesheet href=/styles/iconfont.css><link rel=stylesheet href=/styles/iconfont-patch.css><script defer src=https://umami.yuanpei.me/JXOS5H5V data-website-id=445bd2eb-68f9-47fd-b93a-5dfa92be333d></script></head><body><div class="background patterns"><div class=bg-mask></div></div><style>.background{position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;z-index:-2;&.patterns { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='192' height='192' viewBox='0 0 192 192'%3E%3Cpath fill='%23494849' fill-opacity='0.08' d='M192 15v2a11 11 0 0 0-11 11c0 1.94 1.16 4.75 2.53 6.11l2.36 2.36a6.93 6.93 0 0 1 1.22 7.56l-.43.84a8.08 8.08 0 0 1-6.66 4.13H145v35.02a6.1 6.1 0 0 0 3.03 4.87l.84.43c1.58.79 4 .4 5.24-.85l2.36-2.36a12.04 12.04 0 0 1 7.51-3.11 13 13 0 1 1 .02 26 12 12 0 0 1-7.53-3.11l-2.36-2.36a4.93 4.93 0 0 0-5.24-.85l-.84.43a6.1 6.1 0 0 0-3.03 4.87V143h35.02a8.08 8.08 0 0 1 6.66 4.13l.43.84a6.91 6.91 0 0 1-1.22 7.56l-2.36 2.36A10.06 10.06 0 0 0 181 164a11 11 0 0 0 11 11v2a13 13 0 0 1-13-13 12 12 0 0 1 3.11-7.53l2.36-2.36a4.93 4.93 0 0 0 .85-5.24l-.43-.84a6.1 6.1 0 0 0-4.87-3.03H145v35.02a8.08 8.08 0 0 1-4.13 6.66l-.84.43a6.91 6.91 0 0 1-7.56-1.22l-2.36-2.36A10.06 10.06 0 0 0 124 181a11 11 0 0 0-11 11h-2a13 13 0 0 1 13-13c2.47 0 5.79 1.37 7.53 3.11l2.36 2.36a4.94 4.94 0 0 0 5.24.85l.84-.43a6.1 6.1 0 0 0 3.03-4.87V145h-35.02a8.08 8.08 0 0 1-6.66-4.13l-.43-.84a6.91 6.91 0 0 1 1.22-7.56l2.36-2.36A10.06 10.06 0 0 0 107 124a11 11 0 0 0-22 0c0 1.94 1.16 4.75 2.53 6.11l2.36 2.36a6.93 6.93 0 0 1 1.22 7.56l-.43.84a8.08 8.08 0 0 1-6.66 4.13H49v35.02a6.1 6.1 0 0 0 3.03 4.87l.84.43c1.58.79 4 .4 5.24-.85l2.36-2.36a12.04 12.04 0 0 1 7.51-3.11A13 13 0 0 1 81 192h-2a11 11 0 0 0-11-11c-1.94 0-4.75 1.16-6.11 2.53l-2.36 2.36a6.93 6.93 0 0 1-7.56 1.22l-.84-.43a8.08 8.08 0 0 1-4.13-6.66V145H11.98a6.1 6.1 0 0 0-4.87 3.03l-.43.84c-.79 1.58-.4 4 .85 5.24l2.36 2.36a12.04 12.04 0 0 1 3.11 7.51A13 13 0 0 1 0 177v-2a11 11 0 0 0 11-11c0-1.94-1.16-4.75-2.53-6.11l-2.36-2.36a6.93 6.93 0 0 1-1.22-7.56l.43-.84a8.08 8.08 0 0 1 6.66-4.13H47v-35.02a6.1 6.1 0 0 0-3.03-4.87l-.84-.43c-1.59-.8-4-.4-5.24.85l-2.36 2.36A12 12 0 0 1 28 109a13 13 0 1 1 0-26c2.47 0 5.79 1.37 7.53 3.11l2.36 2.36a4.94 4.94 0 0 0 5.24.85l.84-.43A6.1 6.1 0 0 0 47 84.02V49H11.98a8.08 8.08 0 0 1-6.66-4.13l-.43-.84a6.91 6.91 0 0 1 1.22-7.56l2.36-2.36A10.06 10.06 0 0 0 11 28 11 11 0 0 0 0 17v-2a13 13 0 0 1 13 13c0 2.47-1.37 5.79-3.11 7.53l-2.36 2.36a4.94 4.94 0 0 0-.85 5.24l.43.84A6.1 6.1 0 0 0 11.98 47H47V11.98a8.08 8.08 0 0 1 4.13-6.66l.84-.43a6.91 6.91 0 0 1 7.56 1.22l2.36 2.36A10.06 10.06 0 0 0 68 11 11 11 0 0 0 79 0h2a13 13 0 0 1-13 13 12 12 0 0 1-7.53-3.11l-2.36-2.36a4.93 4.93 0 0 0-5.24-.85l-.84.43A6.1 6.1 0 0 0 49 11.98V47h35.02a8.08 8.08 0 0 1 6.66 4.13l.43.84a6.91 6.91 0 0 1-1.22 7.56l-2.36 2.36A10.06 10.06 0 0 0 85 68a11 11 0 0 0 22 0c0-1.94-1.16-4.75-2.53-6.11l-2.36-2.36a6.93 6.93 0 0 1-1.22-7.56l.43-.84a8.08 8.08 0 0 1 6.66-4.13H143V11.98a6.1 6.1 0 0 0-3.03-4.87l-.84-.43c-1.59-.8-4-.4-5.24.85l-2.36 2.36A12 12 0 0 1 124 13a13 13 0 0 1-13-13h2a11 11 0 0 0 11 11c1.94 0 4.75-1.16 6.11-2.53l2.36-2.36a6.93 6.93 0 0 1 7.56-1.22l.84.43a8.08 8.08 0 0 1 4.13 6.66V47h35.02a6.1 6.1 0 0 0 4.87-3.03l.43-.84c.8-1.59.4-4-.85-5.24l-2.36-2.36A12 12 0 0 1 179 28a13 13 0 0 1 13-13zM84.02 143a6.1 6.1 0 0 0 4.87-3.03l.43-.84c.8-1.59.4-4-.85-5.24l-2.36-2.36A12 12 0 0 1 83 124a13 13 0 1 1 26 0c0 2.47-1.37 5.79-3.11 7.53l-2.36 2.36a4.94 4.94 0 0 0-.85 5.24l.43.84a6.1 6.1 0 0 0 4.87 3.03H143v-35.02a8.08 8.08 0 0 1 4.13-6.66l.84-.43a6.91 6.91 0 0 1 7.56 1.22l2.36 2.36A10.06 10.06 0 0 0 164 107a11 11 0 0 0 0-22c-1.94 0-4.75 1.16-6.11 2.53l-2.36 2.36a6.93 6.93 0 0 1-7.56 1.22l-.84-.43a8.08 8.08 0 0 1-4.13-6.66V49h-35.02a6.1 6.1 0 0 0-4.87 3.03l-.43.84c-.79 1.58-.4 4 .85 5.24l2.36 2.36a12.04 12.04 0 0 1 3.11 7.51A13 13 0 1 1 83 68a12 12 0 0 1 3.11-7.53l2.36-2.36a4.93 4.93 0 0 0 .85-5.24l-.43-.84A6.1 6.1 0 0 0 84.02 49H49v35.02a8.08 8.08 0 0 1-4.13 6.66l-.84.43a6.91 6.91 0 0 1-7.56-1.22l-2.36-2.36A10.06 10.06 0 0 0 28 85a11 11 0 0 0 0 22c1.94 0 4.75-1.16 6.11-2.53l2.36-2.36a6.93 6.93 0 0 1 7.56-1.22l.84.43a8.08 8.08 0 0 1 4.13 6.66V143h35.02z'%3E%3C/path%3E%3C/svg%3E"); } &.dark { &.patterns { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='192' height='192' viewBox='0 0 192 192'%3E%3Cpath fill='%23fcfcfc' fill-opacity='0.08' d='M192 15v2a11 11 0 0 0-11 11c0 1.94 1.16 4.75 2.53 6.11l2.36 2.36a6.93 6.93 0 0 1 1.22 7.56l-.43.84a8.08 8.08 0 0 1-6.66 4.13H145v35.02a6.1 6.1 0 0 0 3.03 4.87l.84.43c1.58.79 4 .4 5.24-.85l2.36-2.36a12.04 12.04 0 0 1 7.51-3.11 13 13 0 1 1 .02 26 12 12 0 0 1-7.53-3.11l-2.36-2.36a4.93 4.93 0 0 0-5.24-.85l-.84.43a6.1 6.1 0 0 0-3.03 4.87V143h35.02a8.08 8.08 0 0 1 6.66 4.13l.43.84a6.91 6.91 0 0 1-1.22 7.56l-2.36 2.36A10.06 10.06 0 0 0 181 164a11 11 0 0 0 11 11v2a13 13 0 0 1-13-13 12 12 0 0 1 3.11-7.53l2.36-2.36a4.93 4.93 0 0 0 .85-5.24l-.43-.84a6.1 6.1 0 0 0-4.87-3.03H145v35.02a8.08 8.08 0 0 1-4.13 6.66l-.84.43a6.91 6.91 0 0 1-7.56-1.22l-2.36-2.36A10.06 10.06 0 0 0 124 181a11 11 0 0 0-11 11h-2a13 13 0 0 1 13-13c2.47 0 5.79 1.37 7.53 3.11l2.36 2.36a4.94 4.94 0 0 0 5.24.85l.84-.43a6.1 6.1 0 0 0 3.03-4.87V145h-35.02a8.08 8.08 0 0 1-6.66-4.13l-.43-.84a6.91 6.91 0 0 1 1.22-7.56l2.36-2.36A10.06 10.06 0 0 0 107 124a11 11 0 0 0-22 0c0 1.94 1.16 4.75 2.53 6.11l2.36 2.36a6.93 6.93 0 0 1 1.22 7.56l-.43.84a8.08 8.08 0 0 1-6.66 4.13H49v35.02a6.1 6.1 0 0 0 3.03 4.87l.84.43c1.58.79 4 .4 5.24-.85l2.36-2.36a12.04 12.04 0 0 1 7.51-3.11A13 13 0 0 1 81 192h-2a11 11 0 0 0-11-11c-1.94 0-4.75 1.16-6.11 2.53l-2.36 2.36a6.93 6.93 0 0 1-7.56 1.22l-.84-.43a8.08 8.08 0 0 1-4.13-6.66V145H11.98a6.1 6.1 0 0 0-4.87 3.03l-.43.84c-.79 1.58-.4 4 .85 5.24l2.36 2.36a12.04 12.04 0 0 1 3.11 7.51A13 13 0 0 1 0 177v-2a11 11 0 0 0 11-11c0-1.94-1.16-4.75-2.53-6.11l-2.36-2.36a6.93 6.93 0 0 1-1.22-7.56l.43-.84a8.08 8.08 0 0 1 6.66-4.13H47v-35.02a6.1 6.1 0 0 0-3.03-4.87l-.84-.43c-1.59-.8-4-.4-5.24.85l-2.36 2.36A12 12 0 0 1 28 109a13 13 0 1 1 0-26c2.47 0 5.79 1.37 7.53 3.11l2.36 2.36a4.94 4.94 0 0 0 5.24.85l.84-.43A6.1 6.1 0 0 0 47 84.02V49H11.98a8.08 8.08 0 0 1-6.66-4.13l-.43-.84a6.91 6.91 0 0 1 1.22-7.56l2.36-2.36A10.06 10.06 0 0 0 11 28 11 11 0 0 0 0 17v-2a13 13 0 0 1 13 13c0 2.47-1.37 5.79-3.11 7.53l-2.36 2.36a4.94 4.94 0 0 0-.85 5.24l.43.84A6.1 6.1 0 0 0 11.98 47H47V11.98a8.08 8.08 0 0 1 4.13-6.66l.84-.43a6.91 6.91 0 0 1 7.56 1.22l2.36 2.36A10.06 10.06 0 0 0 68 11 11 11 0 0 0 79 0h2a13 13 0 0 1-13 13 12 12 0 0 1-7.53-3.11l-2.36-2.36a4.93 4.93 0 0 0-5.24-.85l-.84.43A6.1 6.1 0 0 0 49 11.98V47h35.02a8.08 8.08 0 0 1 6.66 4.13l.43.84a6.91 6.91 0 0 1-1.22 7.56l-2.36 2.36A10.06 10.06 0 0 0 85 68a11 11 0 0 0 22 0c0-1.94-1.16-4.75-2.53-6.11l-2.36-2.36a6.93 6.93 0 0 1-1.22-7.56l.43-.84a8.08 8.08 0 0 1 6.66-4.13H143V11.98a6.1 6.1 0 0 0-3.03-4.87l-.84-.43c-1.59-.8-4-.4-5.24.85l-2.36 2.36A12 12 0 0 1 124 13a13 13 0 0 1-13-13h2a11 11 0 0 0 11 11c1.94 0 4.75-1.16 6.11-2.53l2.36-2.36a6.93 6.93 0 0 1 7.56-1.22l.84.43a8.08 8.08 0 0 1 4.13 6.66V47h35.02a6.1 6.1 0 0 0 4.87-3.03l.43-.84c.8-1.59.4-4-.85-5.24l-2.36-2.36A12 12 0 0 1 179 28a13 13 0 0 1 13-13zM84.02 143a6.1 6.1 0 0 0 4.87-3.03l.43-.84c.8-1.59.4-4-.85-5.24l-2.36-2.36A12 12 0 0 1 83 124a13 13 0 1 1 26 0c0 2.47-1.37 5.79-3.11 7.53l-2.36 2.36a4.94 4.94 0 0 0-.85 5.24l.43.84a6.1 6.1 0 0 0 4.87 3.03H143v-35.02a8.08 8.08 0 0 1 4.13-6.66l.84-.43a6.91 6.91 0 0 1 7.56 1.22l2.36 2.36A10.06 10.06 0 0 0 164 107a11 11 0 0 0 0-22c-1.94 0-4.75 1.16-6.11 2.53l-2.36 2.36a6.93 6.93 0 0 1-7.56 1.22l-.84-.43a8.08 8.08 0 0 1-4.13-6.66V49h-35.02a6.1 6.1 0 0 0-4.87 3.03l-.43.84c-.79 1.58-.4 4 .85 5.24l2.36 2.36a12.04 12.04 0 0 1 3.11 7.51A13 13 0 1 1 83 68a12 12 0 0 1 3.11-7.53l2.36-2.36a4.93 4.93 0 0 0 .85-5.24l-.43-.84A6.1 6.1 0 0 0 84.02 49H49v35.02a8.08 8.08 0 0 1-4.13 6.66l-.84.43a6.91 6.91 0 0 1-7.56-1.22l-2.36-2.36A10.06 10.06 0 0 0 28 85a11 11 0 0 0 0 22c1.94 0 4.75-1.16 6.11-2.53l2.36-2.36a6.93 6.93 0 0 1 7.56-1.22l.84.43a8.08 8.08 0 0 1 4.13 6.66V143h35.02z'%3E%3C/path%3E%3C/svg%3E"); } .cover { filter: brightness(0.6); } } .cover { width: auto; height: auto; min-height: 100%; opacity: 0; transition: filter 0.3s, opacity 0.3s; &.loaded { opacity: 1; } }}</style><header class=main-header><nav class="main-nav up top"><div class=nav-all><div class=left-nav><div class=site-name onclick='location.href="/"'>元视角</div></div><div class=nav-center><div class=site-menu><div class=site-menu><div class=menu-item><span class=link-btn>文库</span><div class=link-child><span class=link-child-btn onclick='window.location.href="/archives"'><i class="iconfont icon-guidang"></i>
文章归档
</span><span class=link-child-btn onclick='window.location.href="/categories"'><i class="iconfont icon-folder"></i>
全部分类
</span><span class=link-child-btn onclick='window.location.href="/tags"'><i class="iconfont icon-hashtag"></i>
全部标签</span></div></div><div class=menu-item><span class=link-btn>书影音</span><div class=link-child><span class=link-child-btn onclick='window.location.href="/books"'><i class="iconfont icon-book-fill"></i>
读书
</span><span class=link-child-btn onclick='window.location.href="/movies"'><i class="iconfont icon-movies"></i>
观影
</span><span class=link-child-btn onclick='window.location.href="/musics"'><i class="iconfont icon-music"></i>
听歌</span></div></div><div class=menu-item><span class=link-btn>页面</span><div class=link-child><span class=link-child-btn onclick='window.location.href="/links"'><i class="iconfont icon-people"></i>
友情链接
</span><span class=link-child-btn onclick='window.location.href="/works"'><i class="iconfont icon-people"></i>
个人作品
</span><span class=link-child-btn onclick='window.location.href="/statics"'><i class="iconfont icon-tongji"></i>
站点统计</span></div></div><div class=menu-item><span class=link-btn>更多</span><div class=link-child><span class=link-child-btn onclick='window.location.href="/comments"'><i class="iconfont icon-chat"></i>
留言
</span><span class=link-child-btn onclick='window.location.href="/about"'><i class="iconfont icon-contacts"></i>
关于本站</span></div></div></div></div><span class=site-title>使用 ASP.NET Core 和 Hangfire 实现 HTTP 异步化方案</span></div><div class=right-nav><a class="menu-btn nav-btn travellings" title=开往-友链接力 href=https://www.travellings.cn/go.html target=_blank><i class="iconfont icon-subway"></i></a><div class="menu-btn nav-btn" title=随机前往一篇文章 id=randomToggle><i class="iconfont icon-shuffle"></i></div><div class="menu-btn nav-btn" title=全站搜索><i class="iconfont icon-search"></i></div><div class="menu-btn nav-btn" id=themeToggle title=切换主题模式><i class="iconfont icon-sun" id=themeIcon></i></div><div id=open-control class="menu-btn nav-btn pc" title=打开中控台><i class="iconfont icon-dashboard"></i></div><div class="to-top menu-btn hidden" title=返回顶部><div class=to-top-btn><span class=num>0</span>
<i class="iconfont icon-up"></i></div></div><div class="menu-btn nav-btn mobile" title=打开菜单><i class="iconfont icon-toc"></i></div></div></div></nav><div class=mobile-menu id=mobileMenu><div class=menu-mask></div><div class="menu-content s-card"><div class=close-control><i class="iconfont icon-close"></i></div><div class=menu-list><div class=menu-item><span class=link-title>文库</span><div class=link-child><div class=link-child-btn onclick='window.location.href="/archives"'><i class="iconfont icon-guidang"></i>
<span class=name>文章归档</span></div><div class=link-child-btn onclick='window.location.href="/categories"'><i class="iconfont icon-folder"></i>
<span class=name>全部分类</span></div><div class=link-child-btn onclick='window.location.href="/tags"'><i class="iconfont icon-hashtag"></i>
<span class=name>全部标签</span></div></div></div><div class=menu-item><span class=link-title>书影音</span><div class=link-child><div class=link-child-btn onclick='window.location.href="/books"'><i class="iconfont icon-book-fill"></i>
<span class=name>读书</span></div><div class=link-child-btn onclick='window.location.href="/movies"'><i class="iconfont icon-movies"></i>
<span class=name>观影</span></div><div class=link-child-btn onclick='window.location.href="/musics"'><i class="iconfont icon-music"></i>
<span class=name>听歌</span></div></div></div><div class=menu-item><span class=link-title>页面</span><div class=link-child><div class=link-child-btn onclick='window.location.href="/links"'><i class="iconfont icon-people"></i>
<span class=name>友情链接</span></div><div class=link-child-btn onclick='window.location.href="/works"'><i class="iconfont icon-people"></i>
<span class=name>个人作品</span></div><div class=link-child-btn onclick='window.location.href="/statics"'><i class="iconfont icon-tongji"></i>
<span class=name>站点统计</span></div></div></div><div class=menu-item><span class=link-title>更多</span><div class=link-child><div class=link-child-btn onclick='window.location.href="/comments"'><i class="iconfont icon-chat"></i>
<span class=name>留言</span></div><div class=link-child-btn onclick='window.location.href="/about"'><i class="iconfont icon-contacts"></i>
<span class=name>关于本站</span></div></div></div></div></div></div><style>.mobile-menu{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:3000;display:none}.mobile-menu .menu-mask{position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;background-color:var(--main-mask-background)}.mobile-menu .menu-content{position:absolute;top:0;right:0;height:100%;width:100%;max-width:300px;border-radius:12px 0 0 12px;padding:20px;overflow:auto}.mobile-menu .close-control{position:absolute;top:10px;right:20px;display:flex;align-items:center;justify-content:center;width:35px;height:35px;padding:0;transition:background-color .3s,opacity .3s;border-radius:50%;cursor:pointer}.mobile-menu .close-control .iconfont{font-size:18px;line-height:1;color:var(--main-font-second-color);transition:color .3s,opacity .3s}.mobile-menu .close-control:hover{background-color:var(--main-color)}.mobile-menu .close-control:hover .iconfont{color:var(--main-card-background)}.mobile-menu .menu-list{margin-top:40px}.mobile-menu .menu-item{margin-bottom:12px}.mobile-menu .menu-item .link-title{font-size:14px;margin-bottom:12px;display:inline-block;color:var(--main-font-second-color)}.mobile-menu .menu-item .link-child{display:grid;gap:12px;grid-template-columns:1fr 1fr}.mobile-menu .menu-item .link-child-btn{display:flex;flex-direction:row;justify-content:flex-start;align-items:center;border-radius:8px;padding:10px 12px;background-color:var(--main-card-background);border:1px solid var(--main-card-border);box-shadow:0 8px 16px -4px var(--main-border-shadow);font-size:15px;cursor:pointer;transition:all .3s}.mobile-menu .menu-item .link-child-btn:hover{background-color:var(--main-color);color:var(--main-card-background)}.mobile-menu .menu-item .link-child-btn .iconfont{margin-right:6px;opacity:.6}.mobile-menu .menu-item .link-child-btn .name{max-width:80px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}</style><script>function toggleMobileMenu(){const e=document.getElementById("mobileMenu");e&&(e.style.display=e.style.display==="none"?"block":"none")}</script><div class=modal id=search-modal><div class=modal-mask></div><div class="modal-main s-card" style=max-width:800px><div class=title><div class=title-left><i class="iconfont icon-search"></i>
<span class=title-text>全局搜索</span></div><i class="iconfont icon-close close" id=modal-close></i></div><div class=modal-content style=--height:80vh><div class=search-modal><div class=search-input><input type=text id=search-input placeholder=今天你想搜点什么？ autocomplete=off></div><div class=search-results><div class=search-list></div><div class=search-empty><i class="iconfont icon-search"></i><p>输入关键字，开始搜索</p></div></div><div class=search-hint><span class=text id=search-hint-text></span>
<span class=text><a class=powered_by href=https://www.fusejs.io/ target=_blank>Fuse.js</a></span></div></div></div></div></div></header><main class=main-layout><div class=post><div class=post-meta><div class=meta><div class=categories><a href=/categories/%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80/ class=cat-item><i class="iconfont icon-folder"></i>
<span class=name>编程语言</span></a></div><div class=tags><a href=/tags/.net-core/ class=tag-item><i class="iconfont icon-hashtag"></i>
<span class=name>.NET Core</span>
</a><a href=/tags/hangfire/ class=tag-item><i class="iconfont icon-hashtag"></i>
<span class=name>Hangfire</span>
</a><a href=/tags/http/ class=tag-item><i class="iconfont icon-hashtag"></i>
<span class=name>HTTP</span></a></div></div><h1 class=title>使用 ASP.NET Core 和 Hangfire 实现 HTTP 异步化方案</h1><div class=other-meta><span class="meta date"><i class="iconfont icon-date"></i>
2019-07-04
</span><span class="update meta"><i class="iconfont icon-time"></i>
2019-07-04
</span><span class="hot meta"><i class="iconfont icon-fire"></i>
<span class=artalk-pv-count id=umami_value_page_pv>0</span>
</span><span class="chat meta hover" data-scroll-to=comments><i class="iconfont icon-chat"></i>
<span id=waline_comments_count class=artalk-comment-count>0</span></span></div></div><div class=post-content><article class="post-article s-card"><div class="expired s-card">本文发表于 <strong>2254</strong> 天前，其中的信息可能已经事过境迁</div><div class="article-gpt s-card"><div class=title><span class=name><i class="iconfont icon-robot"></i>
文章摘要
<i class="iconfont icon-up"></i>
</span><span class=logo>FakeGPT</span></div><div class="content s-card"><span class=text></span></div><div class=meta></div></div><script src=https://npm.elemecdn.com/typeit@8.7.1/dist/index.umd.js></script><script>document.addEventListener("DOMContentLoaded",function(){new TypeIt(".article-gpt .content .text",{strings:"Payne在博客中分享了对XML与JSON在数据交换中的使用背景与困扰，探讨了HTTP异步化方案中的实际场景与解决方法。他介绍了Hangfire作为Quartz的替代品的使用方法和可扩展性，展示了通过HTTP调用的HttpJob的实现方式，以及如何使用Hangfire进行任务调度和记录日志。整体内容围绕着异步化处理、后台任务系统的应用与扩展展开，为读者提供了一些实践参考和技术思路。",speed:10,lifeLike:!0,waitUntilVisible:!0}).go()})</script><div id=page-content class=markdown-main-style><p>Hi，大家好，我是 Payne，欢迎大家一如既往地关注我的博客。今天这篇博客里的故事背景，来自我工作中的一次业务对接，因为客户方提供的是长达上百行的 XML，所以一度让更喜欢使用 JSON 的博主感到沮丧，我这里不是想讨论 XML 和 JSON 彼此的优缺点，而是我不明白 AJAX 里的 X 现在基本都被 JSON 替代了，为什么还有这么多的人坚持使用并友好的 XML 作为数据的交换协议呢？也许你会说，因为有这样或者那样等等的理由，就像 SOA、ESB、SAP 等等类似的技术在企业级用户依然大量流行一样，而这些正是“消费”XML 的主力军。我真正想说的是，在对接这类接口时，我们会遇到一个异步化的 HTTP 协议场景，这里的异步和多线程、async/await 没有直接关系，因为它描述的实际上是业务流程上的一种“异步”。</p><h1 id=引子-想对-xml-说不>引子-想对 XML 说不</h1><p>我们知道，HTTP 协议是一个典型的请求-响应模型，由调用方(Client)调用服务提供者(Server)提供的接口，在理想状态下，后者在处理完请求后会直接返回结果。可是当后者面对的是一个“耗时”任务时，这种方式的问题就立马凸显出来，此时调用者有两个选择：一直等对方返回直至超时(同步)、隔一会儿就看看对方是否处理完了(轮询)。这两种方式，相信大家都非常熟悉了，如果继续延伸下去，我们会联想到长/短轮询、SignalR、WebSocket。其实，更好的方式是，我们接收到一个“耗时”任务时，立即返回表明我们接收了任务，等任务执行完以后再通知调用者，这就是我们今天要说的 HTTP 异步化方案。因为对接过程中，客户采用的就是这种方案，ESB 这类消息总线本身就提供了这种功能，可作为调用方的博主就非常难受啦，因为明明能“同步”地处理完的事情，现在全部要变成“异步”处理，就像一个习惯了 async/await 语法糖的人，突然间就要重新开始写 APM 风格的代码，宝宝心里苦啊，“异步”处理就异步处理嘛，可要按人家要求去返回上百行的 XML，博主表示想死的心都有了好嘛……</p><p>好了，吐槽归吐槽，吐槽完我们继续梳理下 HTTP 异步化的方案，这种方式在现实生活中还是相当普遍的，毕竟人类都是“异步”做事，譬如“等你哪天有空一起吃个饭”，测试同事对我说得最多的话就是，“等你这个 Bug 改完了同我说一声”，更不用说，JavaScript 里典型的异步单线程的应用等等……实现“异步”的思路其实是非常多的，比如同样在 JavaScript 里流行的回调函数，比如通过一张中间表存起来，比如推送消息到消息队列里。在面向数据库编程的时候，我听到最多的话就是，没有什么问题是不能用一张中间表来解决的，如果一张不行那就用两张。项目上我是用 Quartz+中间表的方式实现的，因为这是最为普通的方式。这里，我想和大家分享下，关于使用 Hangfire 来实现类似 Quartz 定时任务的相关内容，果然，我这次又做了一次标题党呢，希望大家会对今天的内容感兴趣。简单来说，我们会提供一个接口，调用方提供参数和回调地址，调用后通过 Hangfire 创建后台任务，等任务处理结束后，再通过回调地址返回结果给调用方，这就是所谓的 HTTP 异步化。</p><h1 id=开箱即用的-hangfire>开箱即用的 Hangfire</h1><p>我们项目上是使用 Quartz 来实现后台任务的，因为它采用了反射的方式来调用具体的 Job，因此，它的任务调度和任务实现是耦合在同一个项目里的，常常出现单个 Job 引发整个系统卡顿的情况，尤其是是它的触发器，常常导致一个 Job 停都停不下来，直到后来才渐渐开始通过 Web API 来分离这两个部分。Quartz 几乎没有一个自己的可视化界面，我们为此专门为它开发了一套 UI。我这里要介绍的 Hangfire，可以说它刚好可以作为 Quartz 的替代品，它是一个开箱即用的、轻量级的、开源后台任务系统，想想以前为 Windows 开发定时任务，只能通过定时器(Timer)来实现，尚不知道 CRON 为何物，而且只能用命令行那种拙劣的方式来安装/卸载，我至今都记得，测试同事问我，能不能不要每次都弹个黑窗口出来，这一起想起来还真是让人感慨啊。好了，下面我们开始今天的实践吧！首先，第一步自然是安装 Hangfire 啦，这里我们新建一个 ASP.NET Core 的 Web API 项目就好，然后通过 NuGet 依次安装以下库：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell><span class=line><span class=cl>Install-Package HangFire
</span></span><span class=line><span class=cl>Install-Package Hangfire.MySql.Core
</span></span></code></pre></div><p>这里我们选择了 MySQL 来实现任务的持久化，从官方的流程图中可以了解到，Hangfire 有服务端、持久化存储和客户端三大核心部件组成，而持久化存储这块儿，除了官方默认的 SQLServer(可以集成 MSMQ)以外，还支持 Redis、MongoDB 等，Hangfire 使用起来是非常简单哒，首先在 Startup 类的 ConfigureServices()方法中注入 Hangfire 相关的服务，然后在 Configure()方法中使用 HangfireServer 和 UseHangfireDashboard 即可：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-CSharp data-lang=CSharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>void</span> <span class=n>ConfigureServices</span> <span class=p>(</span><span class=n>IServiceCollection</span> <span class=n>services</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//为了简化说明，已忽略该方法中无关的代码</span>
</span></span><span class=line><span class=cl>    <span class=n>services</span><span class=p>.</span><span class=n>AddHangfire</span> <span class=p>(</span><span class=n>x</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=p>.</span><span class=n>UseStorage</span> <span class=p>(</span><span class=k>new</span> <span class=n>MySqlStorage</span> <span class=p>(</span><span class=n>Configuration</span><span class=p>.</span><span class=n>GetConnectionString</span> <span class=p>(</span><span class=s>&#34;Hangfire&#34;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>UseFilter</span> <span class=p>(</span><span class=k>new</span> <span class=n>HttpJobFilter</span> <span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>UseSerilogLogProvider</span> <span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>void</span> <span class=n>Configure</span> <span class=p>(</span><span class=n>IApplicationBuilder</span> <span class=n>app</span><span class=p>,</span> <span class=n>IHostingEnvironment</span> <span class=n>env</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//为了简化说明，已忽略该方法中无关的代码</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=p>.</span><span class=n>UseHangfireServer</span> <span class=p>(</span><span class=k>new</span> <span class=n>BackgroundJobServerOptions</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Queues</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[]</span> <span class=p>{</span> <span class=s>&#34;default&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>WorkerCount</span> <span class=p>=</span> <span class=m>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>ServerName</span> <span class=p>=</span> <span class=s>&#34;default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=p>.</span><span class=n>UseHangfireDashboard</span> <span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=p>.</span><span class=n>ApplicationServices</span><span class=p>.</span><span class=n>GetService</span><span class=p>&lt;</span><span class=n>ILoggerFactory</span><span class=p>&gt;</span> <span class=p>().</span><span class=n>AddSerilog</span> <span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>注意到在配置持久化的部分，我们使用了一个数据库连接字符串 Hangfire，它需要我们在 appsettings.json 中配置 ConnectionStrings 部分。这里我们为 Hangfire 设置了默认队列 default、默认服务器 default、并发数目为 5。与此同时，我们开启了 Hangfire 中自带的 Dashboard，可以通过这个界面来监控后台任务的执行情况。此时运行项目，输入以下地址：http://locahost:/hangfire，就会看到下面的画面，这说明 Hangfire 配置成功：</p><p><a class=img-fancybox href=https://ww1.sinaimg.cn/large/4c36074fly1g4vsktdif4j21hb0rz406.jpg data-fancybox=gallery data-src=https://ww1.sinaimg.cn/large/4c36074fly1g4vsktdif4j21hb0rz406.jpg data-caption="Hangfire Dashboard"><img src=https://ww1.sinaimg.cn/large/4c36074fly1g4vsktdif4j21hb0rz406.jpg alt="Hangfire Dashboard" class=post-img loading=lazy>
<span class=post-img-tip>Hangfire Dashboard</span></a></p><p>Hangfire 中默认支持四种类型的后台任务，他们分别是<strong>Fire-and-forget jobs</strong>、<strong>Delayed jobs</strong>、<strong>Recurring jobs</strong>和<strong>Continuations</strong>。严格来说，<strong>Fire-and-forget jobs</strong>和<strong>Delayed jobs</strong>并不能算后台任务，因为它们在执行一次后就会从队列中移除，属于一次性“消费”的任务，这两者的不同在于<strong>Delayed jobs</strong>可以在设定的时间上延迟执行。而<strong>Recurring jobs</strong>和<strong>Continuations</strong>则是周期性任务，任务在入队后可以按照固定的时间间隔去执行，周期性任务都是支持 CRON 表达式的，<strong>Continuations</strong>类似于 Task 中的 ContinueWith()方法，可以对多个任务进行组合，我们现在的项目中开发了大量基于 Quartz 的 Job，可当你试图把这些 Job 相互组合起来的时候，你就会觉得相当尴尬，因为后台任务做所的事情往往都是大同小异的。从官方文档中 ，我们会发现 Hangfire 的关键代码只有下面这四行代码，可以说是相当简洁啦！</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-CSharp data-lang=CSharp><span class=line><span class=cl><span class=c1>//Fire-and-forget jobs</span>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>jobId</span> <span class=p>=</span> <span class=n>BackgroundJob</span><span class=p>.</span><span class=n>Enqueue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>()</span> <span class=p>=&gt;</span> <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Fire-and-forget!&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//Delayed jobs</span>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>jobId</span> <span class=p>=</span> <span class=n>BackgroundJob</span><span class=p>.</span><span class=n>Schedule</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>()</span> <span class=p>=&gt;</span> <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Delayed!&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>TimeSpan</span><span class=p>.</span><span class=n>FromDays</span><span class=p>(</span><span class=m>7</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//Recurring jobs</span>
</span></span><span class=line><span class=cl><span class=n>RecurringJob</span><span class=p>.</span><span class=n>AddOrUpdate</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>()</span> <span class=p>=&gt;</span> <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Recurring!&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>Cron</span><span class=p>.</span><span class=n>Daily</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//Continuations</span>
</span></span><span class=line><span class=cl><span class=n>BackgroundJob</span><span class=p>.</span><span class=n>ContinueWith</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>jobId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>()</span> <span class=p>=&gt;</span> <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Continuation!&#34;</span><span class=p>));</span>
</span></span></code></pre></div><p>Hangfire 除了这种偏函数式风格的用法以外，同样提供了泛型版本的用法，简而言之，泛型版本是自带依赖注入的版本。众所周知，稍微复杂点的功能，常常会依赖多个服务，比如后台任务常常需要给相关人员发邮件或者是消息，此时，Job 的实现就会依赖 MailService 和 MessageService。Hangfire 内置了基于 Autofac 的 IoC 容器，因此，当我们使用泛型版本时，它可以自动地从容器中 Resolve 相应的类型出来。事实上，我们可以通过重写 JobActivator 来实现自己的依赖注入，譬如博主就喜欢 Castle。下面是一个简单的例子：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-CSharp data-lang=CSharp><span class=line><span class=cl><span class=c1>//Define a class depends on IDbContext &amp; IEmailService</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>EmailSender</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>IDbContext</span> <span class=n>_dbContext</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>IEmailService</span> <span class=n>_emailService</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>EmailSender</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_dbContext</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DbContext</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>_emailService</span> <span class=p>=</span> <span class=k>new</span> <span class=n>EmailService</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//When it is registered in Ioc Container</span>
</span></span><span class=line><span class=cl><span class=n>BackgroundJob</span><span class=p>.</span><span class=n>Enqueue</span><span class=p>&lt;</span><span class=n>EmailSender</span><span class=p>&gt;(</span><span class=n>x</span> <span class=p>=&gt;</span> <span class=n>x</span><span class=p>.</span><span class=n>Send</span><span class=p>(</span><span class=s>&#34;Joe&#34;</span><span class=p>,</span> <span class=s>&#34;Hello!&#34;</span><span class=p>));</span>
</span></span></code></pre></div><h1 id=可扩展的-hangfire>可扩展的 Hangfire</h1><p>OK，在对 Hangfire 有了一个初步的了解以后，我们再回到本文的题目，我们希望实现一个基于 HTTP 方式调用的 HttpJob。因为我们不希望任务调度和具体任务放在一起，我们项目上采用 Quartz 来开发后台任务，它要求我们实现一个特定接口 IbaseJob，最终任务调度时会通过反射来创建 Job，就在刚刚过去的这周里，测试同事向我反馈了一个 Bug，而罪魁祸首居然是因为某个 DLL 没有分发，所以，我希望实现一个基于 HTTP 方式调用的 HttpJob，这既是为了将任务调度和具体任务分离，同时为了满足这篇文章开头描述的场景，得益于 Hnagfire 良好的扩展性，我们提供了一组 Web API，代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-CSharp data-lang=CSharp><span class=line><span class=cl><span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// 添加一个任务到队列并立即执行</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;param name=&#34;jobDescriptor&#34;&gt;&lt;/param&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl><span class=na>[HttpPost (&#34;AddEnqueue&#34;)]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>JsonResult</span> <span class=n>Enqueue</span> <span class=p>(</span><span class=n>HttpJobDescriptor</span> <span class=n>jobDescriptor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>jobId</span> <span class=p>=</span> <span class=kt>string</span><span class=p>.</span><span class=n>Empty</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>jobId</span> <span class=p>=</span> <span class=n>BackgroundJob</span><span class=p>.</span><span class=n>Enqueue</span> <span class=p>(()</span> <span class=p>=&gt;</span> <span class=n>HttpJobExecutor</span><span class=p>.</span><span class=n>DoRequest</span> <span class=p>(</span><span class=n>jobDescriptor</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>JsonResult</span> <span class=p>(</span><span class=k>new</span> <span class=p>{</span> <span class=n>Flag</span> <span class=p>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>Message</span> <span class=p>=</span> <span class=s>$&#34;Job:#{jobId}-{jobDescriptor.JobName}已加入队列&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>JsonResult</span> <span class=p>(</span><span class=k>new</span> <span class=p>{</span> <span class=n>Flag</span> <span class=p>=</span> <span class=kc>false</span><span class=p>,</span> <span class=n>Message</span> <span class=p>=</span> <span class=n>ex</span><span class=p>.</span><span class=n>Message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// 添加一个延迟任务到队列</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;param name=&#34;jobDescriptor&#34;&gt;&lt;/param&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl><span class=na>[HttpPost (&#34;AddSchedule&#34;)]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>JsonResult</span> <span class=n>Schedule</span> <span class=p>([</span><span class=n>FromBody</span><span class=p>]</span> <span class=n>HttpJobDescriptor</span> <span class=n>jobDescriptor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>jobId</span> <span class=p>=</span> <span class=kt>string</span><span class=p>.</span><span class=n>Empty</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>jobId</span> <span class=p>=</span> <span class=n>BackgroundJob</span><span class=p>.</span><span class=n>Schedule</span> <span class=p>(()</span> <span class=p>=&gt;</span> <span class=n>HttpJobExecutor</span><span class=p>.</span><span class=n>DoRequest</span> <span class=p>(</span><span class=n>jobDescriptor</span><span class=p>),</span> <span class=n>TimeSpan</span><span class=p>.</span><span class=n>FromMinutes</span> <span class=p>((</span><span class=kt>double</span><span class=p>)</span> <span class=n>jobDescriptor</span><span class=p>.</span><span class=n>DelayInMinute</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>JsonResult</span> <span class=p>(</span><span class=k>new</span> <span class=p>{</span> <span class=n>Flag</span> <span class=p>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>Message</span> <span class=p>=</span> <span class=s>$&#34;Job:#{jobId}-{jobDescriptor.JobName}已加入队列&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>JsonResult</span> <span class=p>(</span><span class=k>new</span> <span class=p>{</span> <span class=n>Flag</span> <span class=p>=</span> <span class=kc>false</span><span class=p>,</span> <span class=n>Message</span> <span class=p>=</span> <span class=n>ex</span><span class=p>.</span><span class=n>Message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// 添加一个定时任务</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;param name=&#34;jobDestriptor&#34;&gt;&lt;/param&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl><span class=na>[HttpPost (&#34;AddRecurring&#34;)]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>JsonResult</span> <span class=n>Recurring</span> <span class=p>([</span><span class=n>FromBody</span><span class=p>]</span> <span class=n>HttpJobDescriptor</span> <span class=n>jobDescriptor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>jobId</span> <span class=p>=</span> <span class=kt>string</span><span class=p>.</span><span class=n>Empty</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>RecurringJob</span><span class=p>.</span><span class=n>AddOrUpdate</span> <span class=p>(</span><span class=n>jobDescriptor</span><span class=p>.</span><span class=n>JobName</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=n>HttpJobExecutor</span><span class=p>.</span><span class=n>DoRequest</span> <span class=p>(</span><span class=n>jobDescriptor</span><span class=p>),</span> <span class=n>jobDescriptor</span><span class=p>.</span><span class=n>Corn</span><span class=p>,</span> <span class=n>TimeZoneInfo</span><span class=p>.</span><span class=n>Local</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>JsonResult</span> <span class=p>(</span><span class=k>new</span> <span class=p>{</span> <span class=n>Flag</span> <span class=p>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>Message</span> <span class=p>=</span> <span class=s>$&#34;Job:{jobDescriptor.JobName}已加入队列&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>JsonResult</span> <span class=p>(</span><span class=k>new</span> <span class=p>{</span> <span class=n>Flag</span> <span class=p>=</span> <span class=kc>false</span><span class=p>,</span> <span class=n>Message</span> <span class=p>=</span> <span class=n>ex</span><span class=p>.</span><span class=n>Message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// 删除一个定时任务</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;param name=&#34;jobName&#34;&gt;&lt;/param&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl><span class=na>[HttpDelete (&#34;DeleteRecurring&#34;)]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>JsonResult</span> <span class=n>Delete</span> <span class=p>(</span><span class=kt>string</span> <span class=n>jobName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>RecurringJob</span><span class=p>.</span><span class=n>RemoveIfExists</span> <span class=p>(</span><span class=n>jobName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>JsonResult</span> <span class=p>(</span><span class=k>new</span> <span class=p>{</span> <span class=n>Flag</span> <span class=p>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>Message</span> <span class=p>=</span> <span class=s>$&#34;Job:{jobName}已删除&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>JsonResult</span> <span class=p>(</span><span class=k>new</span> <span class=p>{</span> <span class=n>Flag</span> <span class=p>=</span> <span class=kc>false</span><span class=p>,</span> <span class=n>Message</span> <span class=p>=</span> <span class=n>ex</span><span class=p>.</span><span class=n>Message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// 触发一个定时任务</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;param name=&#34;jobName&#34;&gt;&lt;/param&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl><span class=na>[HttpGet (&#34;TriggerRecurring&#34;)]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>JsonResult</span> <span class=n>Trigger</span> <span class=p>(</span><span class=kt>string</span> <span class=n>jobName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>RecurringJob</span><span class=p>.</span><span class=n>Trigger</span> <span class=p>(</span><span class=n>jobName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>JsonResult</span> <span class=p>(</span><span class=k>new</span> <span class=p>{</span> <span class=n>Flag</span> <span class=p>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>Message</span> <span class=p>=</span> <span class=s>$&#34;Job:{jobName}已触发执行&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>JsonResult</span> <span class=p>(</span><span class=k>new</span> <span class=p>{</span> <span class=n>Flag</span> <span class=p>=</span> <span class=kc>false</span><span class=p>,</span> <span class=n>Message</span> <span class=p>=</span> <span class=n>ex</span><span class=p>.</span><span class=n>Message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// 健康检查</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl><span class=na>[HttpGet (&#34;HealthCheck&#34;)]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>IActionResult</span> <span class=n>HealthCheck</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>serviceUrl</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=n>JsonResult</span> <span class=p>(</span><span class=k>new</span> <span class=p>{</span> <span class=n>Flag</span> <span class=p>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>Message</span> <span class=p>=</span> <span class=s>&#34;All is Well!&#34;</span><span class=p>,</span> <span class=n>ServiceUrl</span> <span class=p>=</span> <span class=n>serviceUrl</span><span class=p>,</span> <span class=n>CurrentTime</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>你可以注意到，这里用到其实还是四种后台任务，在此基础上增加了删除 Job 和触发 Job 的接口，尤其是触发 Job 执行的接口，可以弥补 Quartz 的不足，很多时候，我们希望别人调了接口后触发后台任务，甚至希望在编写 Job 的过程中使用依赖注入，因为种种原因，实施起来总感觉有点碍手碍脚。这里我们定义了一个 HttpJobExecutor 的类，顾名思义，它是执行 Http 请求的一个类，说来惭愧，我写作这篇博客时，是一边看文档一边写代码的，所以，等我实现了这里的 HttpJobExecutor 的时候，我忽然发现文档中关于依赖注入的内容，简直相见恨晚啊。这里直接给出它的实现，我要再一次安利 RestSharp 这个库，比 HttpWebRequest、HttpClient 这两套官方的 API 要好用许多，可还是有人喜欢一遍又一遍地封装啊，话说自从我们把 WCF 换成 Web API 后，看着相关同事在 Git 上的折腾历史，果然还是回到了写 Http Client 的老路上来，话说在纠结是手写代理还是动态代理的时候，Retrofit 了解下啊！</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=na>[HttpJobFilter]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>DoRequest</span> <span class=p>(</span><span class=n>HttpJobDescriptor</span> <span class=n>jobDestriptor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>client</span> <span class=p>=</span> <span class=k>new</span> <span class=n>RestClient</span> <span class=p>(</span><span class=n>jobDestriptor</span><span class=p>.</span><span class=n>HttpUrl</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>httpMethod</span> <span class=p>=</span> <span class=p>(</span><span class=kt>object</span><span class=p>)</span> <span class=n>Method</span><span class=p>.</span><span class=n>POST</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(!</span><span class=n>Enum</span><span class=p>.</span><span class=n>TryParse</span> <span class=p>(</span><span class=k>typeof</span> <span class=p>(</span><span class=n>Method</span><span class=p>),</span> <span class=n>jobDestriptor</span><span class=p>.</span><span class=n>HttpMethod</span><span class=p>.</span><span class=n>ToUpper</span> <span class=p>(),</span> <span class=k>out</span> <span class=n>httpMethod</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>Exception</span> <span class=p>(</span><span class=s>$&#34;不支持的HTTP动词：{jobDestriptor.HttpMethod}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>request</span> <span class=p>=</span> <span class=k>new</span> <span class=n>RestRequest</span> <span class=p>((</span><span class=n>Method</span><span class=p>)</span> <span class=n>httpMethod</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>jobDestriptor</span><span class=p>.</span><span class=n>JobParameter</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>json</span> <span class=p>=</span> <span class=n>JsonConvert</span><span class=p>.</span><span class=n>SerializeObject</span> <span class=p>(</span><span class=n>jobDestriptor</span><span class=p>.</span><span class=n>JobParameter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=p>.</span><span class=n>AddParameter</span> <span class=p>(</span><span class=s>&#34;application/json&#34;</span><span class=p>,</span> <span class=n>json</span><span class=p>,</span> <span class=n>ParameterType</span><span class=p>.</span><span class=n>RequestBody</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>response</span> <span class=p>=</span> <span class=n>client</span><span class=p>.</span><span class=n>Execute</span> <span class=p>(</span><span class=n>request</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=n>StatusCode</span> <span class=p>!=</span> <span class=n>HttpStatusCode</span><span class=p>.</span><span class=n>OK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>Exception</span> <span class=p>(</span><span class=s>$&#34;调用接口{jobDestriptor.HttpUrl}失败，接口返回：{response.Content}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>在这里，我们以 HealthCheck 这个接口为例，来展示 HttpJob 是如何工作的。顾名思义，这是一个负责健康检查的接口。我们现在通过 Postman 来触发健康检查这个后台任务。在这里，该接口是一个 GET 请求：</p><p><a class=img-fancybox href=https://ww1.sinaimg.cn/large/4c36074fly1g4v4si2z4tj20t10cvaam.jpg data-fancybox=gallery data-src=https://ww1.sinaimg.cn/large/4c36074fly1g4v4si2z4tj20t10cvaam.jpg data-caption=通过Postman创建后台任务><img src=https://ww1.sinaimg.cn/large/4c36074fly1g4v4si2z4tj20t10cvaam.jpg alt=通过Postman创建后台任务 class=post-img loading=lazy>
<span class=post-img-tip>通过Postman创建后台任务</span></a></p><p>接下来，我们我们就会在 Hangfire 的 Dashborad 中找到对应的记录，因为这是一个<strong>Fire & Forget</strong>类型的任务，因此我们几乎看不到中间的过程，它就已经执行结束啦。我们可以在 Dashboard 中找到对应的任务，然后了解它的具体执行情况。值得一提的是，Hangfire 自带了重试机制，对于执行失败的任务，我们可以重试栏目下看到，这里是其中一条任务的执行记录。可以注意到，Hangfire 会把每个 Job 的参数序列化为 JSON 并持久化起来，仔细对照的话，你会发现，它和我们在 Postman 中传入的参数是完全一样的！</p><p><a class=img-fancybox href=https://ww1.sinaimg.cn/large/4c36074fly1g4v55j6cgfj21160j8wfq.jpg data-fancybox=gallery data-src=https://ww1.sinaimg.cn/large/4c36074fly1g4v55j6cgfj21160j8wfq.jpg data-caption=Hangfire中Job执行详情查看><img src=https://ww1.sinaimg.cn/large/4c36074fly1g4v55j6cgfj21160j8wfq.jpg alt=Hangfire中Job执行详情查看 class=post-img loading=lazy>
<span class=post-img-tip>Hangfire中Job执行详情查看</span></a></p><p>在执行 Job 的过程中，我们可能会希望记录 Job 执行过程中的日志。这个时候，Hangfire 强大的扩展性再次我们提供了这种可能性。注意到在 HttpJobExecutor 类上有一个 [HttpJobFilter]的标记，显然这是由 Hangfire 提供的一个过滤器，博主在这个过滤器中对 Job 的 ID、状态等做了记录，因为在整个项目中博主已经配置了 Serilog 作为 Hangfire 的 LogProvider，所以，我们可以在过滤器中使用 Serilog 来记录日志，不过博主个人感觉这个 Filtre 稍显鸡肋，这里还是给出代码片段吧！</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-CSharp data-lang=CSharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>HttpJobFilter</span> <span class=p>:</span> <span class=n>JobFilterAttribute</span><span class=p>,</span> <span class=n>IApplyStateFilter</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=k>readonly</span> <span class=n>ILog</span> <span class=n>Logger</span> <span class=p>=</span> <span class=n>LogProvider</span><span class=p>.</span><span class=n>GetCurrentClassLogger</span> <span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnStateApplied</span> <span class=p>(</span><span class=n>ApplyStateContext</span> <span class=n>context</span><span class=p>,</span> <span class=n>IWriteOnlyTransaction</span> <span class=n>transaction</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=n>NewState</span> <span class=k>is</span> <span class=n>FailedState</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>failedState</span> <span class=p>=</span> <span class=n>context</span><span class=p>.</span><span class=n>NewState</span> <span class=k>as</span> <span class=n>FailedState</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>failedState</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>Logger</span><span class=p>.</span><span class=n>ErrorException</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>String</span><span class=p>.</span><span class=n>Format</span> <span class=p>(</span><span class=s>&#34;Background Job #{0} 执行失败。&#34;</span><span class=p>,</span> <span class=n>context</span><span class=p>.</span><span class=n>BackgroundJob</span><span class=p>.</span><span class=n>Id</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=n>failedState</span><span class=p>.</span><span class=n>Exception</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Logger</span><span class=p>.</span><span class=n>InfoFormat</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s>&#34;当前执行的Job为：#{0}, 状态为：{1}。&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>context</span><span class=p>.</span><span class=n>BackgroundJob</span><span class=p>.</span><span class=n>Id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>context</span><span class=p>.</span><span class=n>NewState</span><span class=p>.</span><span class=n>Name</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnStateUnapplied</span> <span class=p>(</span><span class=n>ApplyStateContext</span> <span class=n>context</span><span class=p>,</span> <span class=n>IWriteOnlyTransaction</span> <span class=n>transaction</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>为什么我说这个 Filter 有点鸡肋呢？因为你看下面的图就会明白了啊！</p><p><a class=img-fancybox href=https://ww1.sinaimg.cn/large/4c36074fly1g4vs8s6f2zj21f2074mxq.jpg data-fancybox=gallery data-src=https://ww1.sinaimg.cn/large/4c36074fly1g4vs8s6f2zj21f2074mxq.jpg data-caption=使用Serilog记录日志><img src=https://ww1.sinaimg.cn/large/4c36074fly1g4vs8s6f2zj21f2074mxq.jpg alt=使用Serilog记录日志 class=post-img loading=lazy>
<span class=post-img-tip>使用Serilog记录日志</span></a></p><h1 id=本文小结>本文小结</h1><p>果然，我还是不得不承认，这又是一篇彻彻底底的"水文"啊,因为写着写着就发现自己变成了标题党。这篇文章总结下来其实只有两句话，一个不喜欢写 XML 报文的博主，如何与 ERP、SAP、ESB 里的 XML 报文斗智斗勇的故事，在这样一个背景下，为了满足对方的"异步"场景, 不得不引入一个后台任务系统来处理这些事情，其实，这个事情用消息队列、用 Redis、甚至普通的中间表都能解决，可惜我写这篇文章的时候，是有一点个人化的情绪在里面的，这种情绪化导致的后果就是，可能我越来越难以控制一篇文章的写作走向啦，大概是写东西越来越困难，而又没有时间取吸收新的知识进来，这让我觉得自己的进步越来越少，Hangfire 的有点说起来就是挺好用的，以上！</p></div><div class="copyright s-card"><div class=title><span class=post-name>使用 ASP.NET Core 和 Hangfire 实现 HTTP 异步化方案</span>
<a :href=https://blog.yuanpei.me/posts/1071063696/ class=post-link target=_blank>https://blog.yuanpei.me/posts/1071063696/</a></div><div class=post-meta><div class=meta-item><span class=tip>作者</span>
<span class=name>飞鸿踏雪</span></div><div class=meta-item><span class=tip>发布于</span>
<span class=name>2019-07-04</span></div><div class=meta-item><span class=tip>更新于</span>
<span class=name>2019-07-04</span></div><div class="meta-item cc"><span class=tip>许可协议</span>
<a class=name href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank>CC BY-NC-SA 4.0</a></div></div><span class=meta-tip>署名-非商业性使用-相同方式共享 4.0 国际</span></div><div class=other-meta><div class=all-tags><a href=/tags/.net-core class=tag-item><i class="iconfont icon-hashtag"></i>
<span class=name>.NET Core</span>
</a><a href=/tags/hangfire class=tag-item><i class="iconfont icon-hashtag"></i>
<span class=name>Hangfire</span>
</a><a href=/tags/http class=tag-item><i class="iconfont icon-hashtag"></i>
<span class=name>HTTP</span></a></div><a href=https://eqnxweimkr5.feishu.cn/share/base/form/shrcnCXCPmxCKKJYI3RKUfefJre class=report target=_blank><i class="iconfont icon-report"></i>
反馈与投诉</a></div><div class=reward><div class=reward-btn onclick='window.$Modal.show("reward-modal")'><i class="iconfont icon-reward"></i>
<span class=text>赞赏博主</span></div></div><div class=modal id=reward-modal><div class=modal-mask></div><div class="modal-main s-card" style=max-width:430px><div class=title><div class=title-left><i class="iconfont icon-reward"></i>
<span class=title-text>赞赏博主</span></div><i class="iconfont icon-close close" id=modal-close></i></div><div class=modal-content style=--height:80vh><div class=reward-card><div class=thank>🙏 请博主喝一杯咖啡</div><div class=qr><a class=qr-img href=/images/reward/alipay.jpg target=_blank><img src=/images/reward/alipay.jpg alt=支付宝赞赏码><div class=tip><i class="iconfont icon-alipay"></i>
<span>支付宝</span></div></a><a class=qr-img href=/images/reward/wechat.jpg target=_blank><img src=/images/reward/wechat.jpg alt=微信赞赏码><div class=tip><i class="iconfont icon-wechat"></i>
<span>微信</span></div></a></div><div class="all-list s-card hover"><div class=title>赞赏记录</div><div class=tip>赞赏金额将全部用于开源项目维护，以及服务器、域名及各类云服务的开销</div></div></div></div></div></div><div class=related-post><div class=title><span class=name><i class="iconfont icon-star"></i>
相关推荐
</span><span class=shuffle onclick='window.location.href="/posts/3040357134/"'>随便逛逛</span></div><div class=post-lists><article class="post-item s-card simple hover" style=animation-delay:.4s onclick='window.location.href="/posts/3687594959/"'><div class=post-content><span class=post-title>.NET Core + ELK 搭建可视化日志分析平台(下)</span>
<span class=post-desc>本文介绍了从 Logstash 到 Filebeat 到 Fluentd 的日志收集工具演进过程，重点讨论了各工具的特点、优缺点以及配置方法。详细说明了 Filebeat 的轻量级特性及配置方式，以及 Fluentd 和 Fluent-Bit 之间的对比和使用方法。同时介绍了 Tail 模式和 Forward 模式下的日志收集策略，以及配置文件示例和实际操作步骤。文章通过讲述作者的个人思考和体验，总结了日志收集工具的选择和使用建议。</span></div></article><article class="post-item s-card simple hover" style=animation-delay:.4s onclick='window.location.href="/posts/2396015802/"'><div class=post-content><span class=post-title>源代码探案系列之 .NET Core 限流中间件 AspNetCoreRateLimit</span>
<span class=post-desc>在今天这篇文章中，探讨了在分布式环境中限流中间件的重要性，引入了 AspNetCoreRateLimit 中间件，采用计数器算法实现限流功能，结合 IMemoryCache 和 IDistributedCache 实现基于内存和分布式缓存的持久化逻辑。详细介绍了 RateLimitProcessor 的实现，包括 ClientRateLimitProcessor 和 IpRateLimitProcessor，以及其依赖的IRateLimitStore 接口。另外，分析了 AsyncKeyLock 的实现，使用 SpinLock 实现了异步读写锁，提高了性能。最后，通过 RateLimitMiddleware 调用链路展示了中间件的整体执行过程。</span></div></article></div><style>.post-lists{width:100%}.post-lists .post-item{padding:0!important;display:flex;margin-bottom:1rem;animation:fade-up .6s backwards;cursor:pointer;overflow:hidden;height:200px}.post-lists .post-item .post-cover{flex:0 0 35%;overflow:hidden;transform:translateZ(0)}.post-lists .post-item .post-cover img{width:100%;height:100%;object-fit:cover;transform-origin:center center;transition:transform .5s ease-out,filter .5s ease-out;backface-visibility:hidden}.post-lists .post-item .post-content{flex:1;padding:1.6rem 2rem;display:flex;flex-direction:column;justify-content:space-between}.post-lists .post-item .post-category{display:flex;flex-wrap:wrap;width:100%;color:var(--main-font-second-color);font-size:14px}.post-lists .post-item .post-category .cat-name{display:flex;flex-direction:row;align-items:center}.post-lists .post-item .post-category .cat-name .iconfont{opacity:.8;margin-right:6px;color:var(--main-font-second-color)}.post-lists .post-item .post-category .top{margin-left:12px;color:var(--main-color)}.post-lists .post-item .post-category .top .iconfont{opacity:.8;color:var(--main-color)}.post-lists .post-item .post-title{font-size:20px;line-height:30px;font-weight:700;margin:.6rem 0;transition:color .3s;display:-webkit-box;overflow:hidden;word-break:break-all;-webkit-box-orient:vertical;-webkit-line-clamp:2}.post-lists .post-item .post-desc{margin-top:-.4rem;margin-bottom:.8rem;opacity:.8;line-height:30px;display:-webkit-box;overflow:hidden;word-break:break-all;-webkit-box-orient:vertical;-webkit-line-clamp:2}.post-lists .post-item .post-meta{display:flex;flex-direction:row;align-items:center;justify-content:space-between;color:var(--main-font-second-color)}.post-lists .post-item .post-tags{display:flex;flex-wrap:wrap;opacity:.8;margin-right:20px;overflow:hidden;mask:linear-gradient(90deg,#fff 0,#fff 90%,hsla(0,0%,100%,.6) 95%,hsla(0,0%,100%,0) 100%)}.post-lists .post-item .post-tags .tags-name{display:flex;flex-direction:row;align-items:center;margin-right:12px;white-space:nowrap;transition:color .3s}.post-lists .post-item .post-time{opacity:.6;font-size:13px;white-space:nowrap}.post-lists .post-item:hover .post-cover img{filter:brightness(.8);transform:scale(1.05)}.post-lists .post-item:hover .post-title{color:var(--main-color)}.post-lists .post-item:active{transform:scale(.98)}.post-lists .post-item.cover-left{flex-direction:row}.post-lists .post-item.cover-right{flex-direction:row-reverse}.post-lists .post-item.cover-both:nth-child(odd){flex-direction:row}.post-lists .post-item.cover-both:nth-child(even){flex-direction:row-reverse}.post-lists.layout-grid{display:grid;grid-template-columns:repeat(var(--grid-columns,2),1fr);gap:var(--grid-gap,1rem)}.post-lists.layout-grid .post-item{margin:0;flex-direction:column;height:auto}.post-lists.layout-grid .post-item .post-cover{flex:none;width:100%;height:225px}@media(max-width:768px){.post-lists .post-item{flex-direction:column;height:auto}.post-lists .post-item .post-cover{flex:none;width:100%;height:200px}.post-lists .post-item.cover-left,.post-lists .post-item.cover-right,.post-lists .post-item.cover-both{flex-direction:column!important}.post-lists.layout-grid{grid-template-columns:1fr}.post-lists .post-item .post-tags{flex-wrap:nowrap}}.post-lists .post-item .simple{animation:none;padding:.5rem 1.4rem!important;background-color:var(--main-card-second-background);height:auto;margin-bottom:.5rem}.post-lists .post-item .simple .post-content{padding:.5rem 0}.post-lists .post-item .simple .post-title{margin:0;font-size:16px}.post-lists .post-item .simple .post-desc{margin:.3rem 0 0;font-size:14px;opacity:.6}</style></div><style>.related-post{margin-top:1rem}.related-post .title{display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%;margin:3rem 0 1rem;padding:0 6px}.related-post .title .name{display:flex;align-items:center;font-size:24px;font-weight:700}.related-post .title .name .iconfont{font-size:26px;font-weight:400;margin-right:8px}.related-post .title .shuffle{opacity:.6;font-size:14px;transition:color .3s,opacity .3s;cursor:pointer}.related-post .title .shuffle:hover{opacity:1;color:var(--main-color)}</style><div id=comments><div id=main-comment class=comment style=padding-left:1.5rem;padding-right:1.5rem><div v-if=!fill class=title><span class=name><i class="iconfont icon-chat"></i>
评论
</span><span class=tool>隐私政策</span></div><link rel=stylesheet href=https://unpkg.com/@waline/client@v3/dist/waline.css><div id=waline class=waline-container></div><style>.waline-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}.waline-container .vcount{color:var(--card-text-color-main)}.waline-container .wl-content img{width:unset!important;max-width:unset!important;max-height:unset!important;border-radius:unset!important}.waline-container .wl-content p{font-size:.9rem!important}.wl-header label{font-size:.8em}.wl-sort li{font-size:.8em}</style><script type=module>
        import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';
        init({
            el: '#waline',
            serverURL: 'https:\/\/waline.yuanpei.me\/',
            lang: 'zh',
            dark: 'auto',
            path: window.location.href,
            requiredMeta: ['nick','mail'],
            emoji: [
                '//unpkg.com/@waline/emojis@1.2.0/weibo'
            ],
            reaction: false,
        });
      </script></div></div><div class="next-post s-card" id=next-post data-is-next=true><a href=/posts/1540537013/ class=next-post-link><span class=post-tip>下一篇阅读
</span><span class=post-title>长安十二时辰随想</span></a></div></article><aside class=main-aside><div class="hello s-card weidgets"><span class=tip id=hello-weidget-tip>好久不见</span><div class=content><div class=site-logo><div class=avatar><img src=/images/avatar.jpg alt=avatar loading=lazy></div></div><span class=site-desc>谢谢你，在这世界的角落，找到我。我是一位穿梭于数字与人文领域交界处的观察者，热衷于在数字迷雾中剖析谜题背后的真相，同时在人文星河中重拾温暖和光明。我期待，在元视角的坐标系下，找到理性思考与感性体验共鸣完美平衡的交汇点。</span></div><div class=info><div class=name><span class=author>飞鸿踏雪</span>
<span class=desc>纵有疾风起，人生不言弃</span></div><div class=link><a href=https://github.com/qinyuanpei target=_blank class=social-link aria-label=GitHub><i class="iconfont icon-github"></i>
</a><a href=mailto:qinyuapei@163.com target=_blank class=social-link aria-label=Email><i class="iconfont icon-email"></i></a></div></div></div><div class=sticky><div class="toc s-card weidgets" id=weidget-toc><div class=toc-title><i class="iconfont icon-toc"></i>
<span class=name>目录</span></div><div id=toc-all class=toc-list></div></div><script>document.addEventListener("DOMContentLoaded",function(){const o=[];let e=null,t=null,n=0;const s=document.getElementById("toc-all"),i=()=>{try{if(e=document.getElementById("page-content"),!e)return!1;const t=Array.from(e.querySelectorAll("h1, h2, h3, h4")).filter(e=>e.parentElement.tagName.toLowerCase()==="div");return t}catch(e){console.error("获取所有目录数据出错：",e)}},r=()=>{const e=i();if(!e)return!1;s.innerHTML="",e.forEach((e,t)=>{const n={id:e.id,type:e.tagName,text:e.textContent?.replace(/\u200B/g,"").trim()},i=document.createElement("span");i.id="toc-"+n.id,i.className=`toc-item ${n.type} ${t===0?"active":""}`,i.textContent=n.text,i.addEventListener("click",()=>d(n.id)),s.appendChild(i),o.push(n)}),e&&e.length>0&&(t=e[0].id)},c=(e,t)=>{let n;return function(){const s=arguments,o=this;n||(e.apply(o,s),n=!0,setTimeout(()=>n=!1,t))}},l=c(()=>{if(!o.length)return!1;const e=i();if(!e)return!1;const s=120;if(window.scrollY===0){n=0,t=e[0]?.id,a();return}for(let n of e){const o=n.getBoundingClientRect();o.top-s<=0&&o.bottom+s>=0&&t!==n.id&&(t=n.id,a())}},100),a=()=>{document.querySelectorAll(".toc-item.active").forEach(e=>{e.classList.remove("active")});const e=document.getElementById("toc-"+t);if(!e)return!1;e.classList.add("active"),n=e.offsetTop-2||0,s.style.setProperty("--height",n+"px"),s.scrollTo({top:n-80,behavior:"smooth"})},d=t=>{try{const n=document.getElementById(t);if(!n||!e)return!1;const s=n.offsetTop,o=s+e.offsetTop-80;window.scroll({top:o,behavior:"smooth"})}catch(e){console.error("目录滚动失败：",e)}};r(),window.addEventListener("scroll",l)})</script><style lang=scss scoped>.toc{position:relative;padding:0!important;overflow:hidden;.toc-title { display: flex; flex-direction: row; align-items: center; padding: 18px; height: 58px; .iconfont { margin-right: 8px; font-weight: bold; opacity: 0.6; } .name { font-weight: bold; } } .toc-list { position: relative; padding: 20px; padding-top: 0; padding-left: 24px; display: flex; flex-direction: column; max-height: calc(70vh - 58px); overflow: auto; .toc-item { margin: 4px 0; padding: 6px 12px; border-radius: 8px; opacity: 0.6; transition: color 0.3s, opacity 0.3s, font-size 0.3s, background-color 0.3s; cursor: pointer; &:first-child { margin-top: 0; } &:last-child { margin-bottom: 0; } &.H1 { font-weight: bold; } &.H2 { font-size: 14px; margin-left: 15px; font-weight: normal; } &.H3 { font-size: 12px; margin-left: 25px; } &.active { opacity: 1; color: var(--main-color); background-color: var(--main-color-bg); &.H2 { font-size: 14px; } &.H3 { font-size: 12px; } } &:hover { opacity: 1; color: var(--main-color); background-color: var(--main-color-bg); } } &::after { content: ""; position: absolute; left: 12px; top: var(--height); width: 4px; height: 20px; margin: 8px 0; background-color: var(--main-color); border-radius: 8px; transition: top 0.3s; } } &::before { content: ""; position: absolute; left: 12px; bottom: 20px; width: 4px; height: calc(100% - 78px); background-color: var(--main-card-border); border-radius: 8px; }}</style><div class="tags-cloud s-card weidgets"><div class=title><i class="iconfont icon-hashtag"></i>
<span class=title-name>热门标签</span></div><div class=all-tags><a href=/tags/%E5%BC%82%E6%AD%A5/ class=tags><span class=name>异步</span>
<sup class=num>2</sup>
</a><a href=/tags/jupyter/ class=tags><span class=name>Jupyter</span>
<sup class=num>1</sup>
</a><a href=/tags/lambda/ class=tags><span class=name>Lambda</span>
<sup class=num>2</sup>
</a><a href=/tags/hashset/ class=tags><span class=name>HashSet</span>
<sup class=num>1</sup>
</a><a href=/tags/%E8%A3%85%E9%A5%B0%E5%99%A8/ class=tags><span class=name>装饰器</span>
<sup class=num>1</sup>
</a><a href=/tags/%E5%9B%9E%E9%A1%BE/ class=tags><span class=name>回顾</span>
<sup class=num>1</sup>
</a><a href=/tags/%E7%A0%94%E5%8F%91/ class=tags><span class=name>研发</span>
<sup class=num>1</sup>
</a><a href=/tags/%E6%97%A5%E5%BF%97/ class=tags><span class=name>日志</span>
<sup class=num>5</sup>
</a><a href=/tags/%E5%9B%9E%E5%AE%B6/ class=tags><span class=name>回家</span>
<sup class=num>1</sup>
</a><a href=/tags/%E5%90%91%E9%87%8F/ class=tags><span class=name>向量</span>
<sup class=num>2</sup>
</a><a href=/tags/%E9%AA%8C%E8%AF%81/ class=tags><span class=name>验证</span>
<sup class=num>1</sup>
</a><a href=/tags/%E5%B9%B3%E5%87%A1/ class=tags><span class=name>平凡</span>
<sup class=num>1</sup>
</a><a href=/tags/%E5%BC%95%E6%93%8E/ class=tags><span class=name>引擎</span>
<sup class=num>1</sup>
</a><a href=/tags/%E7%AE%A1%E9%81%93/ class=tags><span class=name>管道</span>
<sup class=num>1</sup>
</a><a href=/tags/%E8%AF%BB%E4%B9%A6/ class=tags><span class=name>读书</span>
<sup class=num>6</sup>
</a><a href=/tags/dottrace/ class=tags><span class=name>DotTrace</span>
<sup class=num>1</sup>
</a><a href=/tags/restful/ class=tags><span class=name>RESTful</span>
<sup class=num>4</sup>
</a><a href=/tags/sublime/ class=tags><span class=name>Sublime</span>
<sup class=num>1</sup>
</a><a href=/tags/%E9%99%90%E6%B5%81/ class=tags><span class=name>限流</span>
<sup class=num>1</sup>
</a><a href=/tags/%E7%BC%96%E8%AF%91/ class=tags><span class=name>编译</span>
<sup class=num>1</sup>
</a><a href=/tags/opencv/ class=tags><span class=name>OpenCV</span>
<sup class=num>5</sup>
</a><a href=/tags/signalr/ class=tags><span class=name>SignalR</span>
<sup class=num>2</sup>
</a><a href=/tags/%E5%A4%95%E9%9B%BE%E8%8A%B1%E5%9B%AD/ class=tags><span class=name>夕雾花园</span>
<sup class=num>1</sup>
</a><a href=/tags/form/ class=tags><span class=name>Form</span>
<sup class=num>1</sup>
</a><a href=/tags/rpg/ class=tags><span class=name>RPG</span>
<sup class=num>1</sup>
</a><a href=/tags/svn/ class=tags><span class=name>SVN</span>
<sup class=num>1</sup>
</a><a href=/tags/%E5%8D%83%E5%AF%BB%E5%B0%8F%E5%A7%90/ class=tags><span class=name>千寻小姐</span>
<sup class=num>1</sup>
</a><a href=/tags/%E5%A2%9E%E5%BC%BA%E7%8E%B0%E5%AE%9E/ class=tags><span class=name>增强现实</span>
<sup class=num>4</sup>
</a><a href=/tags/echarts/ class=tags><span class=name>ECharts</span>
<sup class=num>1</sup>
</a><a href=/tags/gephi/ class=tags><span class=name>Gephi</span>
<sup class=num>1</sup>
</a><a href=/tags/%E8%BD%AC%E7%9B%98/ class=tags><span class=name>转盘</span>
<sup class=num>1</sup>
</a><a href=/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/ class=tags><span class=name>反编译</span>
<sup class=num>1</sup>
</a><a href=/tags/%E9%95%BF%E5%AE%89/ class=tags><span class=name>长安</span>
<sup class=num>2</sup>
</a><a href=/tags/%E9%80%9A%E4%BF%A1/ class=tags><span class=name>通信</span>
<sup class=num>2</sup>
</a><a href=/tags/delayqueue/ class=tags><span class=name>DelayQueue</span>
<sup class=num>1</sup>
</a><a href=/tags/hyperlog/ class=tags><span class=name>Hyperlog</span>
<sup class=num>1</sup>
</a><a href=/tags/%E6%A6%82%E7%8E%87/ class=tags><span class=name>概率</span>
<sup class=num>2</sup>
</a><a href=/tags/%E4%B8%83%E7%89%9B/ class=tags><span class=name>七牛</span>
<sup class=num>1</sup>
</a><a href=/tags/cts/ class=tags><span class=name>CTS</span>
<sup class=num>1</sup>
</a><a href=/tags/%E4%BD%90%E8%97%A4%E5%81%A5/ class=tags><span class=name>佐藤健</span>
<sup class=num>1</sup>
</a><a href=/tags/chatgpt/ class=tags><span class=name>ChatGPT</span>
<sup class=num>3</sup>
</a><a href=/tags/%E5%AF%B9%E8%B1%A1%E6%B1%A0/ class=tags><span class=name>对象池</span>
<sup class=num>1</sup>
</a><a href=/tags/ado.net/ class=tags><span class=name>ADO.NET</span>
<sup class=num>1</sup>
</a><a href=/tags/cors/ class=tags><span class=name>CORS</span>
<sup class=num>2</sup>
</a><a href=/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/ class=tags><span class=name>游戏开发</span>
<sup class=num>10</sup>
</a><a href=/tags/%E8%AF%97%E4%BA%BA/ class=tags><span class=name>诗人</span>
<sup class=num>1</sup>
</a><a href=/tags/%E8%B7%A8%E5%B9%B3%E5%8F%B0/ class=tags><span class=name>跨平台</span>
<sup class=num>3</sup>
</a><a href=/tags/nlp/ class=tags><span class=name>NLP</span>
<sup class=num>3</sup>
</a><a href=/tags/%E6%B8%B8%E6%88%8F/ class=tags><span class=name>游戏</span>
<sup class=num>13</sup>
</a><a href=/tags/jwt/ class=tags><span class=name>JWT</span>
<sup class=num>1</sup></a></div><a href=/tags class=more-tags>查看全部</a></div><div class="site-data s-card weidgets"><div class=title><i class="iconfont icon-chart"></i>
<span class=title-name>站点数据</span></div><div class=all-data><div class=data-item><span class=name><i class="iconfont icon-article"></i>
文章总数
</span><span class=num>281 篇</span></div><div class=data-item><span class=name><i class="iconfont icon-date"></i>
建站天数
</span><span class=num>3901 天</span></div><div class=data-item><span class=name><i class="iconfont icon-words"></i>
全站字数
</span><span class=num>109033 字</span></div><div class=data-item><span class=name><i class="iconfont icon-visibility"></i>
总访问量
</span><span class=num id=umami_value_site_pv></span></div><div class=data-item><span class=name><i class="iconfont icon-account"></i>
总访客数
</span><span class=num id=umami_value_site_uv></span></div></div></div></div></aside><style>.main-aside{padding-left:1rem;display:flex;flex-direction:column;animation:fade-up .6s .3s backwards;.weidgets { padding: 18px; margin-bottom: 1rem; :deep(.title) { margin-bottom: 12px; font-weight: bold; display: flex; align-items: center; opacity: 0.75; .iconfont { opacity: 0.6; margin-right: 6px; } .title-name { opacity: 0.8; } } } .sticky { position: sticky; top: calc(60px + 1rem); .weidgets { animation: fade-up 0.6s 0.4s backwards; &:last-child { margin-bottom: 0; } } }}</style></div></div></main><div class=footer-link><div class=footer-bar><span class=site-title>元视角</span>
<span class=site-desc>纵有疾风起，人生不言弃</span>
<a href=/ class=to-home>了解更多</a></div><div class=footer-social><a href=https://github.com/qinyuanpei target=_blank class=social-link aria-label=GitHub><i class="iconfont icon-github"></i>
</a><a href=mailto:qinyuanpei@163.com target=_blank class=social-link aria-label=Email><i class="iconfont icon-email"></i>
</a><a href=/index.xml target=_blank class=social-link aria-label=RSS><i class="iconfont icon-rss"></i></a><div class=logo title=返回顶部 onclick='window.scrollTo({top:0,behavior:"smooth"})'><img src=/images/icons8-stellar-128.png alt=author class=author></div><a href=https://weibo.com/1278609231 target=_blank class=social-link aria-label=微博><i class="iconfont icon-weibo"></i>
</a><a href=https://www.douban.com/people/60029335/ target=_blank class=social-link aria-label=豆瓣><i class="iconfont icon-douban"></i>
</a><a href=https://www.zhihu.com/people/qinyuanpei target=_blank class=social-link aria-label=知乎><i class="iconfont icon-zhihu"></i></a></div><div class=footer-sitemap><div class=sitemap-item><span class=title>博客</span><div class=links><a href=/archives class=link-text>文章归档
</a><a href=/categories class=link-text>全部分类
</a><a href=/tags class=link-text>全部标签</a></div></div><div class=sitemap-item><span class=title>项目</span><div class=links><a href=https://github.com/qinyuanpei/mcp-server-weibo target=_blank class=link-text>mcp-server-weibo</a></div></div><div class=sitemap-item><span class=title>专栏</span><div class=links><a href=https://blog.csdn.net/qinyuanpei/category_10852603.html target=_blank class=link-text>.NET 源代码探案系列
</a><a href=https://blog.csdn.net/qinyuanpei/category_7444699.html target=_blank class=link-text>Python 数据挖掘系列
</a><a href=https://blog.csdn.net/qinyuanpei/category_11484903.html target=_blank class=link-text>分布式丛林探险系列
</a><a href=https://blog.csdn.net/qinyuanpei/category_1708629.html target=_blank class=link-text>Unity3D 游戏开发系列</a></div></div><div class=sitemap-item><span class=title>页面</span><div class=links><a href=/comments class=link-text>留言
</a><a href=/books class=link-text>读书
</a><a href=/movies class=link-text>观影
</a><a href=/musics class=link-text>听歌</a></div></div><div class=sitemap-item><span class=title>友情链接</span><div class=links><a href=https://gudong.site/ target=_blank class=link-text>咕咚同学
</a><a href=https://coolshell.cn/ target=_blank class=link-text>酷壳
</a><a href=https://blog.zhheo.com/ target=_blank class=link-text>张洪
</a><a href=/links class=link-text>更多</a></div></div></div></div><footer id=main-footer class=main-footer><div class=footer-content><div class=footer-copyright><span class=time data-v-6001e979>@ 2014 - 2025 </span><a href=/ class="author link" target=_blank>飞鸿踏雪</a></div><div class=meta><a class="power link" href=https://gohugo.io/ target=_blank><span class=by>Powered by</span>
<span class=name>Hugo</span>
</a><a class="theme link" href=https://github.com/imsyy/vitepress-theme-curve><span class=name>主题</span>
</a><a class="rss link" href=/index.xml target=_blank><i class="iconfont icon-rss"></i>
<span class=name data-v-6001e979>订阅</span>
</a><a class="cc link" href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank aria-label="Creative Commons"><i class="iconfont icon-line"></i>
<i class="iconfont icon-by-line"></i>
<i class="iconfont icon-nc-line"></i>
<i class="iconfont icon-nd-line"></i></a></div></div></footer><script type=module src=/scripts/main.js></script><script src=https://cdn.jsdelivr.net/npm/fuse.js@7.1.0></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/highlight.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/styles/github-dark.min.css media="(prefers-color-scheme: dark)"><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/styles/github.min.css media="(prefers-color-scheme: light)"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css><script src=https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js></script><script src=https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js></script><script type=text/javascript src=/scripts/modules/badge.js></script><script type=text/javascript>window.createBadge("Hugo","v0.126.1","#35495e","#41b883"),window.createBadge("Github","25a391a","#35495e","#ffc107")</script></body></html>